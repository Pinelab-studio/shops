"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[163],{3163:(k,u,a)=>{a.r(u),a.d(u,{OrderExportModule:()=>c});var p=a(2703),i=a(734),h=a(5774),v=a(5972),t=a(5220),n=a(4725),d=a(4225),g=a(1133),b=a(647);function y(f,r){if(1&f&&(t.j41(0,"option",8),t.EFF(1),t.k0s()),2&f){const e=r.$implicit;t.Y8G("value",e),t.R7$(),t.SpI(" ",e," ")}}class l{constructor(r,e,o,s,m){this.formBuilder=r,this.dataService=e,this.changeDetector=o,this.notificationService=s,this.localStorageService=m,this.strategies=[],this.form=this.formBuilder.group({startsAt:null,endsAt:null,strategy:null}),this.serverPath=(0,i.lr8)()}ngOnInit(){this.dataService.query(v.Ay`
          query availableOrderExportStrategies {
            availableOrderExportStrategies
          }
        `).single$.subscribe(r=>{this.strategies=r.availableOrderExportStrategies,this.form.controls.strategy.setValue(this.strategies?.[0])})}download(){var r=this;return(0,h.A)(function*(){try{const e=yield fetch(`${r.serverPath}/export-orders/export/${r.form.value.strategy}?startDate=${r.form.value.startsAt}&endDate=${r.form.value.endsAt}`,{headers:r.getHeaders()});if(!e.ok){const S=yield e.json();throw Error(S?.message)}const m=e.headers.get("Content-Disposition").split(";")[1].split("=")[1],E=yield e.blob();yield r.downloadBlob(E,m)}catch(e){console.error(e),r.notificationService.error(e.message)}})()}getHeaders(){const r={},e=this.localStorageService.get("activeChannelToken");e&&(r["vendure-token"]=e);const o=this.localStorageService.get("authToken");return o&&(r.authorization=`Bearer ${o}`),r}downloadBlob(r,e){return(0,h.A)(function*(){const o=window.URL.createObjectURL(r),s=document.createElement("a");document.body.appendChild(s),s.setAttribute("hidden","true"),s.href=o,s.download=e,s.setAttribute("target","_blank"),s.click()})()}static#t=this.\u0275fac=function(e){return new(e||l)(t.rXU(n.ok),t.rXU(i.uSP),t.rXU(t.gRc),t.rXU(i.JEu),t.rXU(i.sji))};static#e=this.\u0275cmp=t.VBU({type:l,selectors:[["order-export-component"]],decls:24,vars:9,consts:[["id","export-form",1,"form",3,"formGroup"],[1,"form-block"],[1,"flex"],["required","","timeGranularityInterval","60","formControlName","startsAt"],["required","","timeGranularityInterval","60","formControlName","endsAt"],["clrSelect","","name","options","formControlName","strategy","required",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click","disabled"],[3,"value"]],template:function(e,o){1&e&&(t.j41(0,"h1"),t.EFF(1,"Export orders"),t.k0s(),t.j41(2,"form",0)(3,"section",1)(4,"div",2)(5,"div")(6,"label"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"vdr-datetime-picker",3),t.k0s(),t.j41(10,"div")(11,"label"),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.nrm(14,"vdr-datetime-picker",4),t.k0s()(),t.nrm(15,"br"),t.j41(16,"clr-select-container")(17,"label"),t.EFF(18,"Export as"),t.k0s(),t.j41(19,"select",5),t.DNE(20,y,2,2,"option",6),t.k0s()(),t.nrm(21,"br"),t.j41(22,"button",7),t.bIt("click",function(){return o.download()}),t.EFF(23," Export "),t.k0s()()()),2&e&&(t.R7$(2),t.Y8G("formGroup",o.form),t.R7$(5),t.JRh(t.bMT(8,5,"order.placed-at-start")),t.R7$(5),t.JRh(t.bMT(13,7,"order.placed-at-end")),t.R7$(8),t.Y8G("ngForOf",o.strategies),t.R7$(2),t.Y8G("disabled",o.form.invalid||o.form.pristine))},dependencies:[d.aZZ,d.Yf6,d.hTQ,g.Sq,n.qT,n.xH,n.y7,n.wz,n.BC,n.cb,n.YS,n.j4,n.JD,i.Vr5,i.jx7,b.D9],encapsulation:2})}class c{static#t=this.\u0275fac=function(e){return new(e||c)};static#e=this.\u0275mod=t.$C({type:c});static#r=this.\u0275inj=t.G2t({imports:[i.GgS,p.iI.forChild([{path:"",pathMatch:"full",component:l,data:{breadcrumb:"Export orders"}}])]})}}}]);
//# sourceMappingURL=163.59ff177f9f2414b5.js.map