"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[617],{7617:(b,s,i)=>{i.r(s),i.d(s,{GoedgepicktModule:()=>f});var n=i(2703),l=i(734),u=i(5774),k=i(5972);const m=k.Ay`
  mutation updateGoedgepicktConfig($input: GoedgepicktConfigInput!) {
    updateGoedgepicktConfig(input: $input) {
      ... on GoedgepicktConfig {
        enabled
        apiKey
        webshopUuid
        orderWebhookKey
        orderWebhookUrl
        stockWebhookKey
        stockWebhookUrl
      }
      ... on GoedgepicktError {
        message
      }
    }
  }
`,y=k.Ay`
  query goedgepicktConfig {
    goedgepicktConfig {
      enabled
      apiKey
      webshopUuid
      orderWebhookKey
      orderWebhookUrl
      stockWebhookKey
      stockWebhookUrl
    }
  }
`,g=k.Ay`
  mutation runGoedgepicktFullSync {
    runGoedgepicktFullSync
  }
`;var v=i(6513),U=i.n(v),e=i(5220),c=i(4725),h=i(4225),W=i(1133);function G(a,o){if(1&a&&(e.j41(0,"vdr-chip",24),e.nrm(1,"clr-icon",25),e.EFF(2),e.k0s()),2&a){const t=e.XpG();e.R7$(2),e.SpI(" ",t.testFailed," ")}}function K(a,o){if(1&a&&(e.j41(0,"vdr-chip",26),e.nrm(1,"clr-icon",27),e.EFF(2),e.k0s()),2&a){const t=e.XpG();e.R7$(2),e.SpI(" ",t.testResultName," ")}}class p{constructor(o,t,r,d){this.formBuilder=o,this.dataService=t,this.changeDetector=r,this.notificationService=d,this.loadingSync=!1,this.form=this.formBuilder.group({enabled:["enabled"],apiKey:["your-api-key"],webshopUuid:["webshopUuid"],orderWebhookUrl:["orderWebhookUrl"],orderWebhookKey:["orderWebhookKey"],stockWebhookUrl:["stockWebhookUrl"],stockWebhookKey:["stockWebhookKey"]})}ngOnInit(){var o=this;return(0,u.A)(function*(){yield o.dataService.query(y).mapStream(t=>t.goedgepicktConfig).subscribe(t=>{o.form.controls.enabled.setValue(t.enabled),o.form.controls.apiKey.setValue(t.apiKey),o.form.controls.webshopUuid.setValue(t.webshopUuid),o.form.controls.orderWebhookUrl.setValue(t.orderWebhookUrl),o.form.controls.orderWebhookKey.setValue(t.orderWebhookKey),o.form.controls.stockWebhookUrl.setValue(t.stockWebhookUrl),o.form.controls.stockWebhookKey.setValue(t.stockWebhookKey)})})()}save(){var o=this;return(0,u.A)(function*(){try{if(o.form.dirty){const t=o.form.value,{updateGoedgepicktConfig:r}=yield o.dataService.mutate(m,{input:{enabled:t.enabled,apiKey:t.apiKey,webshopUuid:t.webshopUuid}}).toPromise();o.form.controls.enabled.setValue(r.enabled),o.form.controls.apiKey.setValue(r.apiKey),o.form.controls.webshopUuid.setValue(r.webshopUuid),o.form.controls.orderWebhookUrl.setValue(r.orderWebhookUrl),o.form.controls.orderWebhookKey.setValue(r.orderWebhookKey),o.form.controls.stockWebhookUrl.setValue(r.stockWebhookUrl),o.form.controls.stockWebhookKey.setValue(r.stockWebhookKey)}o.form.markAsPristine(),o.changeDetector.markForCheck(),o.notificationService.success("common.notify-update-success",{entity:"GoedgepicktConfig"})}catch{o.notificationService.error("common.notify-update-error",{entity:"GoedgepicktConfig"})}})()}fullSync(){var o=this;return(0,u.A)(function*(){try{o.loadingSync=!0,yield o.dataService.mutate(g).toPromise(),o.notificationService.success("common.notify-update-success",{entity:"products and stocklevels"})}catch(t){o.notificationService.error(t.message)}finally{o.loadingSync=!1}})()}test(){var o=this;return(0,u.A)(function*(){o.testFailed=void 0,o.testResultName=void 0;const t=yield U()("https://account.goedgepickt.nl/api/v1/webshops",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${o.form.controls.apiKey.value}`},redirect:"follow"});if(200!==t.status)return void(o.testFailed="Invalid ApiKey");const d=(yield t.json()).items?.find(C=>C.uuid===o.form.controls.webshopUuid.value);d?o.testResultName=d.name:o.testFailed="Apikey is correct, but cannot find webshopUuid"})()}static#e=this.\u0275fac=function(t){return new(t||p)(e.rXU(c.ok),e.rXU(l.uSP),e.rXU(e.gRc),e.rXU(l.JEu))};static#o=this.\u0275cmp=e.VBU({type:p,selectors:[["goedgepickt-component"]],decls:32,vars:5,consts:[[1,"clr-row"],[1,"clr-col"],[1,"btn","btn-secondary",3,"click","disabled"],["content","Pushes products and pulls stocklevels from Goedgepickt"],[1,"form",3,"formGroup"],[1,"form-block"],["label","Enabled","for","enabled"],["type","checkbox","name","enabled","clrCheckbox","","formControlName","enabled"],["label","apikey","for","apiKey"],["id","apiKey","type","text","formControlName","apiKey"],["label","webshopUuid","for","webshopUuid"],["id","webshopUuid","type","text","formControlName","webshopUuid"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-secondary",3,"click"],["title","Failed","colorType","error",4,"ngIf"],["title","Success!","colorType","success",4,"ngIf"],["label","Order webhook","for","orderWebhookUrl","tooltip","Goedgepickt will call this URL for order status updates"],["id","orderWebhookUrl","type","text","formControlName","orderWebhookUrl","disabled","disabled"],["label","Webhook auth secret","for","orderWebhookKey"],["id","orderWebhookKey","type","text","formControlName","orderWebhookKey","disabled","disabled"],["label","Stock webhook","for","stockWebhookUrl","tooltip","Goedgepickt will call this URL for stocklevel updates"],["id","stockWebhookUrl","type","text","formControlName","stockWebhookUrl","disabled","disabled"],["label","Webhook auth secret","for","stockWebhookKey"],["id","stockWebhookKey","type","text","formControlName","stockWebhookKey","disabled","disabled"],["title","Failed","colorType","error"],["shape","error-standard"],["title","Success!","colorType","success"],["shape","check-circle"]],template:function(t,r){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){return r.fullSync()}),e.EFF(3," Synchronize "),e.k0s(),e.nrm(4,"vdr-help-tooltip",3),e.j41(5,"form",4)(6,"section",5)(7,"vdr-form-field",6),e.nrm(8,"input",7),e.k0s(),e.j41(9,"vdr-form-field",8),e.nrm(10,"input",9),e.k0s(),e.j41(11,"vdr-form-field",10),e.nrm(12,"input",11),e.k0s(),e.j41(13,"button",12),e.bIt("click",function(){return r.save()}),e.EFF(14," Save "),e.k0s(),e.j41(15,"button",13),e.bIt("click",function(){return r.test()}),e.EFF(16,"Test"),e.k0s(),e.DNE(17,G,3,1,"vdr-chip",14)(18,K,3,1,"vdr-chip",15),e.k0s(),e.j41(19,"section",5)(20,"p"),e.EFF(21," The following settings are set automatically and cannot be edited "),e.k0s(),e.nrm(22,"br"),e.j41(23,"vdr-form-field",16),e.nrm(24,"input",17),e.k0s(),e.j41(25,"vdr-form-field",18),e.nrm(26,"input",19),e.k0s()(),e.j41(27,"section",5)(28,"vdr-form-field",20),e.nrm(29,"input",21),e.k0s(),e.j41(30,"vdr-form-field",22),e.nrm(31,"input",23),e.k0s()()()()()),2&t&&(e.R7$(2),e.Y8G("disabled",r.loadingSync),e.R7$(3),e.Y8G("formGroup",r.form),e.R7$(8),e.Y8G("disabled",r.form.invalid||r.form.pristine),e.R7$(4),e.Y8G("ngIf",r.testFailed),e.R7$(),e.Y8G("ngIf",r.testResultName))},dependencies:[h.U4n,h.Jej,W.bT,c.qT,c.me,c.Zm,c.BC,c.cb,c.j4,c.JD,l.wux,l.KSf,l.Vr5,l.oXY],encapsulation:2})}class f{static#e=this.\u0275fac=function(t){return new(t||f)};static#o=this.\u0275mod=e.$C({type:f});static#t=this.\u0275inj=e.G2t({providers:[(0,l.VqZ)({id:"goedgepickt",label:"Goedgepickt",routerLink:["/extensions/goedgepickt"],icon:"cursor-hand-open"},"settings")],imports:[l.GgS,n.iI.forChild([{path:"",pathMatch:"full",component:p,data:{breadcrumb:"Goedgepickt"}}])]})}},6513:(b,s)=>{var n=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}();b.exports=s=n.fetch,n.fetch&&(s.default=n.fetch.bind(n)),s.Headers=n.Headers,s.Request=n.Request,s.Response=n.Response}}]);
//# sourceMappingURL=617.a61ff7cc2012e196.js.map